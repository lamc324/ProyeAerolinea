<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
	<meta name="viewport"  content="width=device-width, initial-scale=1">
    <title>Home | MOZUHE Arlines</title>
	<link rel="stylesheet" title="style" type="text/css" href="css/home-estilos.css">
	<link rel="stylesheet" title="style" type="text/css" href="css/banner1.css">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Tangerine">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<!--JS-->
        <script type="text/javascript" src="js/Ruta.js"></script>
	<script type="text/javascript" src="js/Vuelo.js"></script>
        <script type="text/javascript" src="js/Ciudad.js"></script>
        <script type="text/javascript" src="js/Horario.js"></script>
        <script type="text/javascript" src="js/Avion.js"></script>
	<script type="text/javascript" src="js/StorageRuta.js"></script>
	<script type="text/javascript" src="js/StorageVuelo.js"></script>
	<script type="text/javascript" src="js/Proxy.js"></script>
        <script type="text/javascript" src="js/JsonUtils.js"></script>
      
        <!--JAVA-->
         <script type="text/java" src="../../src/java/airline/model/AirlineModel.java"></script>
         <script type="text/java" src="../../src/java/airline/services/AirlineService.java"></script>
	
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        
        <!-- Bootstrap Date-Picker Plugin -->
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/js/bootstrap-datepicker.min.js"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/css/bootstrap-datepicker3.css"/>
        
        <!-- DataTables -->
        <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/dt/dt-1.10.15/datatables.min.css"/>
        <script type="text/javascript" src="https://cdn.datatables.net/v/dt/dt-1.10.15/datatables.min.js"></script>

	
	</head>

	<body data-spy="scroll" data-target=".navbar" data-offset="50">
        
        <!-- Pequeño menu de arriba de la página -->
        <nav class="navbar navbar-inverse" data-spy="affix" data-offset-top="1">
            <div class="container-fluid">
                <div class="navbar-header">
                  <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">  
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>  
                  </button>
                   
                </div>
                <div class="collapse navbar-collapse" id="myNavbar">
                    <ul class="nav navbar-nav">
                        <li><a href="quienes.html" target="frame">¿Quienes Somos?</a></li>
                        <li><a href="contactenos.html" target="frame">Contacto</a></li>
                        <li><a href="MenuAdmin.html" target="frame">Administrativos</a></li>
                    </ul>
                        <ul class="nav navbar-nav navbar-right">
                        <li><a href="register.html" target="frame"><span class="glyphicon glyphicon-user"></span> Registrarse</a></li>
                        <li><a href="login.html" target="frame" ><span class="glyphicon glyphicon-log-in"></span> Acceder a mi cuenta</a></li>
                    </ul>
                </div>
            </div>
        </nav>
        
        <div class="background-container container-fluid">
        
        <div class="container header">
					<div class="part1-header">
						<table>
							<tr>
								<td><img class="logo img-responsive" src="./images/mozuhe-logo.png" width="130" height="100"></td>
								<td><h1>&nbsp Agencia de Viajes</h1></td>
							</tr>
						</table>
					</div>
        </div>
        <div class="container">
            <br>
        </div>
            
        <div class="container">
            <div class="row">
                <div class="col-sm-12">
                            
                    <div class="panel panel-primary">
                        <div class="panel-heading"><h1>¡Busca tu Vuelo Ahora!</h1></div>
                            <div class="well table-responsive">
                                
                                <form method="POST" name="formulario" id="formulario" action="javascript:doSubmit();">
                                    <div class="input-group">
                                        <span class="input-group-addon" id="basic-addon3">Origen</span>
                                        <Select class ="form-control" name="origen" id="origen">
                                        </Select> 
                                   
                                        <span class="input-group-addon" id="basic-addon3">Destino</span>
                                        <Select class ="form-control" name="destino" id="destino">
                                        </Select> 
                                   
                                        <span class="input-group-addon" id="basic-addon3">Salida</span>
                                        <input class="form-control" id="date" name="date" placeholder="YYYY-MM-DD" type="text"/>
                                    
                                        <span class="input-group-addon" id="basic-addon3">Precio</span>
                                        <Select class ="form-control" name="precio" id="precio">
                                        
                                        </Select>
                                    
                                    </div>
                                    
                                    <br>
                                    <label class="checkbox-inline"><input type="checkbox" value="" id="idaVuelta">Viaje de ida y vuelta</label>
                                    
                                    <input type="button" class="btn btn-primary btn-block btn-lg" name="botonBuscar" id="botonBuscar" value="Buscar">
                                    <br><br>
                                    
                                    <div id="BusquedalistadoDiv" style="display: block; vertical-align:top;">
						                
                                        <table id="BusquedalistadoT" class="display" data-page-length='10'>
                                            <thead><tr>
                                                <th>Origen</th>
                                                <th>Destino</th>
                                                <th>Salida</th>
                                                <th>Precio</th>
                                                </tr></thead>
                                            <tbody id="Busquedalistado"><tr>
                                                <th></th>
                                                <th></th>
                                                <th></th>
                                                <th></th>
                                                </tr></tbody>
						                </table>
                                    </div> 
                                </form>
                                      
                        </div>
                 </div>
                
              </div>
            <div class="col-sm-12">
                <div id="myCarousel" class="carousel slide" data-ride="carousel">
                  <!-- Indicators -->
                  <ol class="carousel-indicators">
                    <li data-target="#myCarousel" data-slide-to="0" class="active"></li>
                    <li data-target="#myCarousel" data-slide-to="1"></li>
                    <li data-target="#myCarousel" data-slide-to="2"></li>
                  </ol>

                  <!-- Wrapper for slides -->
                  <div class="carousel-inner" role="listbox">
                    <div class="item active">
                      <img src="linda-ciudad.jpg" alt="Image">
                      <div class="carousel-caption table-responsive">
                        <table class="slider-table">
				            <thead class="primer-fila-rojo"><tr><th>Vuelo</th><th>Fecha Salida</th><th>Precio</th></tr></thead>
				            <tbody id="listado"></tbody>
				        </table>
                          
                           <table class="slider-table">
				            <thead class="primer-fila-rojo"><tr><th>Vuelo</th><th>Fecha Salida</th><th>Precio</th></tr></thead>
				            <tbody id="listado1"></tbody>
				        </table>
                          
                      </div>      
                    </div>

                    <div class="item">
                      <img src="linda-ciudad2.jpg" alt="Image">
                      <div class="carousel-caption">
                            <table class="slider-table">
								<thead class="primer-fila-rojo"><tr><th>Vuelo</th><th>Fecha Salida</th><th>Precio</th></tr></thead>
								<tbody id="listado2"></tbody>
				            </table>
                      </div>      
                    </div>
                      
                    <div class="item">
                      <img src="linda-ciudad3.jpg" alt="Image">
                      <div class="carousel-caption">
                            <table class="slider-table">
								<thead class="primer-fila-rojo"><tr><th>Vuelo</th><th>Fecha Salida</th><th>Precio</th></tr></thead>
								<tbody id="listado3"></tbody>
				            </table>
                      </div>      
                    </div>
                  </div>

                  <!-- Left and right controls -->
                  <a class="left carousel-control" href="#myCarousel" role="button" data-slide="prev">
                    <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                    <span class="sr-only">Previous</span>
                  </a>
                  <a class="right carousel-control" href="#myCarousel" role="button" data-slide="next">
                    <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
                    <span class="sr-only">Next</span>
                  </a>
                </div>
              </div>
            </div>
            <hr>
        </div>
     </div>
        
        <!-- Menu del pie de la página -->
        <div class="foot container-fluid">
			 <div class="container">
				<div class="bottom-menu">
					<h3>ACERCA DE MOZUHE</h3>
					<ul class="item-lower-menu">
						<li><a href="quienes.html" target="frame">¿Quiénes Somos?</a></li>
						<li></li>
					</ul>
				</div>
				
				<div class="bottom-menu">
					<h3>SERVICIO AL CLIENTE</h3>
					<ul class="item-lower-menu">
						<li>Ayuda</li>
						<li>Plan de Servicio al Cliente</li>	
					</ul>
				</div>
		   </div>
        </div>
    
<script>
    $(document).ready(function(){
      var date_input=$('input[name="date"]'); //our date input has the name "date"
      var container=$('.bootstrap-iso form').length>0 ? $('.bootstrap-iso form').parent() : "body";
      var options={
        format: 'yyyy-mm-dd',
        container: container,
        todayHighlight: true,
        autoclose: true,
      };
      date_input.datepicker(options);
    });
     </script>  
 
<script> //Model
    function AirlineModel(){
        this.AirlineModel();
    }
    
    AirlineModel.prototype={
        AirlineModel:function(){
        }
    };
</script>

<script> //Controller
    function ControllerAerolinea(model, view){
        this.ControllerAerolinea(model,view);
        
    };
    
    ControllerAerolinea.prototype={
        ControllerAerolinea: function (model, view){
            this.model= model;
            this.view = view;
            Proxy.getRutas(function(result){
                model.rutas=result;
                }
            );
            
            Proxy.getVuelos(function(result){
              model.vuelo=result;
              view.cargaOpcionesVuelo(model.vuelo);
              view.listBusquedas(model.vuelo);}
            );
            model.buscados=[];
        },
        
        buscar: function(view){
            var origen = this.view.$("origen").val();
            var destino = this.view.$("destino").val();
            var salida = this.view.$("date").val();
            var precio = this.view.$("precio").val();
            var pagina = this.view.$("pagination").val();
            var listado=this.view.$("Busquedalistado").val();
            var idaVuelta = this.view.$("idaVuelta").val();

            Proxy.vuelosSearch(origen,destino,precio,salida,function(result){
                model.buscados = result;
                view.doBusqueda();}
             );
        }   
        
    };

</script>

<script> //View
    var model;
    var controller;
    var ciuOrigen =[];
    var ciuDestino=[];
    function pageLoad(event){ 
        model = new AirlineModel();
        controller = new ControllerAerolinea(model,window);
        
        jQuery(function(){$("#salida").datepicker();});
        
        $(document).ready( function () {
        table = $('#BusquedalistadoT').DataTable();
         } );
	
	$("#botonBuscar").click (function(){controller.buscar(window);});
}

function cargaOpcionesVuelo(v){

        
        var origen = document.getElementById("origen");
	var destino = document.getElementById("destino");
	var precio = document.getElementById("precio");
	
	origen.options[0] = new Option(" ");
	destino.options[0] = new Option(" ");
	precio.options[0] = new Option(" ");
	
	for(j = 0; j < v.length; j++){
	   if (!encontrarOrigen(v[j].ruta.lOrigen.nombre))
		   ciuOrigen.push(v[j].ruta.lOrigen);
	   if (!encontrarDestino(v[j].ruta.lDestino.nombre))
		   	  ciuDestino.push(v[j].ruta.lDestino);
   }
   
	for(i = 0; i < ciuOrigen.length;i++){
		origen.options[i+1] = new Option(ciuOrigen[i].nombre);
	}
	
	for(i = 0; i < ciuDestino.length;i++){
		destino.options[i+1] = new Option(ciuDestino[i].nombre);
	}
	
	for(i = 0; i < v.length;i++){
		precio.options[i+1] = new Option(v[i].ruta.horario.precio);
	}
}

 function encontrarDestino(nombre){   
	 return ciuDestino.find(function(x) {return x.nombre === nombre;});
 }	
 
 function encontrarOrigen(nombre){   
	 return ciuOrigen.find(function(x) {return x.nombre === nombre;});
 }

function doBusqueda(){ //buscar
    var origen = document.getElementById("origen");
    var destino = document.getElementById("destino");
    var salida = document.getElementById("date");
    var precio = document.getElementById("precio");
    var pagina = document.getElementById("pagination");
    var listado=document.getElementById("Busquedalistado");
    var idaVuelta = document.getElementById("idaVuelta");
    
    //Borra primero toda la tabla de busqueda
    var rows = table.rows().remove().draw();
	
	if(origen.value== "" && destino.value =="" && salida.value=="" && precio.value == ""){
		 if(idaVuelta.checked == true)
             buscarIdaVuelta(model.vuelo);
            else{
                for(i = 0; i<model.vuelo.length; i++)
                    insertaVuelo(model.vuelo[i]);
            }
	} 
	 else 
		valorVuelos(origen.value,destino.value,salida.value, precio.value, idaVuelta);
  }
  
  function valorVuelos(origen,destino,salida, precio, idaVuelta){
		aux=model.vuelo;
      
	 if(origen!=="")
		  aux= porOrigen(origen,aux);
	  
	  if(destino!="")
		aux= porDestino(destino,aux);
	  
	  if(salida!="")	
		aux = porSalida(salida,aux);
      
       if(precio!="")	
		aux = porPrecio(precio,aux);
      
      if(idaVuelta.checked == true)
          buscarIdaVuelta(aux);
	
		else { 
        for(i = 0; i<aux.length; i++)
                insertaVuelo(aux[i]);
             }
  }

function buscarIdaVuelta(lista){
    var mismoDestino =[];
    var aux=[];
    for(i = 0; i<lista.length; i++){
        
        mismoDestino =porOrigen(lista[i].ruta.lDestino.nombre, lista); 
        if(mismoDestino){ 
            for(j = 0; j<mismoDestino.length; j++){
                if(mismoDestino[j].ruta.lDestino.nombre === lista[i].ruta.lOrigen.nombre){
                    if (porId(mismoDestino[j].identificador, aux) === "")
                        aux.push(mismoDestino[j]);
                    if (porId(lista[i].identificador, aux) === "")
                        aux.push(lista[i]);
                    
                }
            }
        }
    }
    
    for(n = 0; n<aux.length; n++)
        insertaVuelo(aux[n]);
}

  
function porId(id,aux) {
	  return aux.filter( (vls) => vls.identificador.indexOf(id) > -1 );
}

  function porSalida(salida,aux) {
	  return aux.filter( (vls) => vls.ruta.horario.fechSalida.indexOf(salida) > -1 );
    }
    
  function porPrecio(precio,aux) {
	  return aux.filter( (vls) => vls.ruta.horario.precio.indexOf(precio) > -1 );
    }
  
  function porOrigen(lOrigen,aux) {
	 return aux.filter( (vls) => vls.ruta.lOrigen.nombre.toLowerCase().indexOf(lOrigen.toLowerCase()) > -1 );
    }
  
  function porDestino(lDestino,aux) {
	 return aux.filter( (vls) => vls.ruta.lDestino.nombre.toLowerCase().indexOf(lDestino.toLowerCase()) > -1 );
  }
		

function insertaVuelo(vuelo){
    table.row.add( [vuelo.ruta.lOrigen.nombre, vuelo.ruta.lDestino.nombre, 
                     vuelo.ruta.horario.fechSalida,
                           vuelo.ruta.horario.precio] ).draw().node();        
}
 
 function encontrarVuelo(origen,destino){   
	 return vuelos.find(function(x) {return (x.ruta.lDestino.nombre === destino) && (x.ruta.lOrigen.nombre === origen);});
 }	
 
 function encontrarVueloOrigen(nombre){   
	 return vuelos.find(function(x) {return x.ruta.lOrigen.nombre === nombre;});
 }	

function plusDivs(n) {
  showDivs(slideIndex += n);
}

function currentDiv(n) {
  showDivs(slideIndex = n);
}

function generateRandom(number){
	return Math.floor((Math.random() * number-1) + 1);
}


function listRutas(ruts){
	var listado=document.getElementById("listado");
	var randomNumbers=[];
	var number;
	listado.innerHTML="";
	for (i=0;i<ruts.length;i++){
		number=generateRandom(ruts.length);
		if(listado != null){
			
			for(j=0;j<randomNumbers.length;j++){
				if(randomNumbers[j] == number){ 
					number=generateRandom(ruts.length);
					j=-1;
				}
			}
			
			listRuta(listado,ruts[number]);
			listado=document.getElementById("listado"+parseInt(i+1));
			randomNumbers[i]=number;
		}
	}
  }
  
  function listRutaOld(listado,rut){
		var tr =document.createElement("tr");
		var td;
		var textF;
		var img;
		
		td=document.createElement("td");
		td.appendChild(document.createTextNode(rut.identificador));
		tr.appendChild(td);
		
		td =document.createElement("td");
		td.appendChild(document.createTextNode(rut.lOrigen.nombre + " - " + rut.lDestino.nombre));
		tr.appendChild(td);
		
		td =document.createElement("td");
		td.appendChild(document.createTextNode(rut.horario.precio + "$"));
		tr.appendChild(td);
		
		listado.appendChild(tr);  
		
		tr = document.createElement("tr");
		td=document.createElement("td");
		tr.appendChild(td);
		
		td=document.createElement("td");
		boton = document.createElement("Button");
        boton.className = "btn btn-primary btn-md";
		var t = document.createTextNode("Comprar");
		boton.appendChild(t);
		td.appendChild(boton);
		tr.appendChild(td);
		listado.appendChild(tr);
  }
  
  function listBusquedas(vuelos){
	var listado=document.getElementById("listado");
	var randomNumbers=[];
	var number;
	listado.innerHTML="";
	for (i=0;i<vuelos.length;i++){
		number=generateRandom(vuelos.length);
		if(listado != null){
			
			for(j=0;j<randomNumbers.length;j++){
				if(randomNumbers[j] == number){ 
					number=generateRandom(vuelos.length);
					j=-1;
				}
			}
			
			listBusqueda(listado,vuelos[number]);
			listado=document.getElementById("listado"+parseInt(i+1));
			randomNumbers[i]=number;
		}
	}
  }
  
  function listBusqueda(listado,vuelo){
		var tr =document.createElement("tr");
		var td;
		var textF;
		var img;
		
		td=document.createElement("td");
		td.appendChild(document.createTextNode(vuelo.ruta.lOrigen.nombre + " - " + vuelo.ruta.lDestino.nombre));
		tr.appendChild(td);
		
		td =document.createElement("td");
		td.appendChild(document.createTextNode(vuelo.ruta.horario.fechSalida));
		tr.appendChild(td);
		
		td =document.createElement("td");
		td.appendChild(document.createTextNode(vuelo.ruta.horario.precio + "$"));
		tr.appendChild(td);
		
		listado.appendChild(tr);  
      
        tr = document.createElement("tr");
		td=document.createElement("td");
		tr.appendChild(td);
		
		td=document.createElement("td");
		boton = document.createElement("Button");
        boton.className = "btn btn-primary btn-md";
		var t = document.createTextNode("Comprar");
		boton.appendChild(t);
		td.appendChild(boton);
		tr.appendChild(td);
		listado.appendChild(tr);
  }
  
  document.addEventListener("DOMContentLoaded",pageLoad); 
</script>
        </body>